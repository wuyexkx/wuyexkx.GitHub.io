<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="2021/05/14/atlas200dk-mind-studio-wang-ye-ban-local/"/>
      <url>2021/05/14/atlas200dk-mind-studio-wang-ye-ban-local/</url>
      
        <content type="html"><![CDATA[<p>找到Mind_Studio对应的版本：<a href="https://www.huaweicloud.com/ascend/resources/Tools/0">https://www.huaweicloud.com/ascend/resources/Tools/0</a><br><img src="./images/202105070846386.png" alt="在这里插入图片描述"><br>DDK对应的版本，<a href="https://www.huaweicloud.com/ascend/resources/Tools/1">https://www.huaweicloud.com/ascend/resources/Tools/1</a><br><img src="./images/2020042619470513.png" alt="在这里插入图片描述"><br>最后下载了就是这四个东西，<br><img src="./images/20200426194754795.png" alt="在这里插入图片描述"><br>在那两个压缩包里找到这两个恶心的东西，<code>check_sha.sh</code>和<code>mind_studio.sh</code>，修改掉，<br><img src="./images/20200426195741286.png" alt="在这里插入图片描述"><br><img src="./images/20200426195306272.png" alt="在这里插入图片描述"><br><img src="./images/20200426195516668.png" alt="在这里插入图片描述"><br><img src="./images/20200426195617211.png" alt="在这里插入图片描述"><br>最后在Google Chrome上登陆，</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">https://192.168.1.120:8888密码 xxxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/05/14/atlas-200-hilens-kit-local/"/>
      <url>2021/05/14/atlas-200-hilens-kit-local/</url>
      
        <content type="html"><![CDATA[<p>@[toc]<br><a href="https://bbs.huaweicloud.com/forum/thread-38487-1-1.html">常见技术问题https://bbs.huaweicloud.com/forum/thread-38487-1-1.html</a></p><h1 id="默认密码"><a href="#默认密码" class="headerlink" title="默认密码"></a>默认密码</h1><p><img src="./images/20200606112709619.png" alt="在这里插入图片描述"><br><img src="./images/20200606172303193.png" alt="在这里插入图片描述"></p><h1 id="硬件支持"><a href="#硬件支持" class="headerlink" title="硬件支持"></a>硬件支持</h1><p>最多8路网络摄像头  1路USB摄像头。</p><p>Hilens Kit USB接口当前只支持接linux UVC协议的USB免驱摄像头，不支持键盘、鼠标。</p><p>  红色（闪烁）：表示系统产生告警。<br>   红绿（交替闪烁）：表示系统存储介质主备区异常。<br>   红色（亮2-3秒后熄灭）：表示系统进入重启状态。</p><h1 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h1><p>查看PDF<br>分享</p><p>HiLens Kit目前支持以下三种方式安装软件包：</p><pre><code>pip安装：执行python3 -m pip install安装pip包，如requests；也可以使用其他pip源,如python3 -m pip install requests -i http://pypi.douban.com/simple --trusted-host pypi.douban.com源码编译安装：下载源码编译aarch64版本的软件包。rpm包安装：华为开源镜像站上下载相应的rpm包及其依赖并使用rpm安装软件包。也可以参考论坛安装yum，然后使用yum安装相应的包。</code></pre><h1 id="拷贝文件到Hilens"><a href="#拷贝文件到Hilens" class="headerlink" title="拷贝文件到Hilens"></a>拷贝文件到Hilens</h1><p>先登入Hilens的ssh界面，<br>然后<code>scp -r 主机用户名@主机IP:主机文件 HilensKit路径</code><br><code>scp -r username@192.168.1.104:xxx ./</code></p><p><img src="./images/2020061117274924.png" alt="在这里插入图片描述"><br><img src="./images/20200611172731626.png" alt="在这里插入图片描述"></p><h1 id="修改登录方式为root-shell超时"><a href="#修改登录方式为root-shell超时" class="headerlink" title="修改登录方式为root shell超时"></a>修改登录方式为root shell超时</h1><p><a href="https://bbs.huaweicloud.com/forum/thread-38487-1-1.html">https://bbs.huaweicloud.com/forum/thread-38487-1-1.html</a></p><h2 id="1-如何用root登录，并关闭连接超时？"><a href="#1-如何用root登录，并关闭连接超时？" class="headerlink" title="1 如何用root登录，并关闭连接超时？"></a>1 如何用root登录，并关闭连接超时？</h2><p>超时控制有3个位置：sshd超时、clp超时(15min)、shell超时(5min)。clp超时目前还无法关闭，无论是否有操作，15分钟后断线。<br>1、 关闭sshd超时：<br>以账号名登录（默认admin），切换到develop模式。<code>sudo vi /etc/ssh/sshd_config</code>，找到以下设备并对应修改<br>PermitRootLogin yes（默认为PermitRootLogin no）<br>（以下语句默认开头无注释，修改为在前面增加注释符号，去掉限制root登陆的设置）<br>#ClientAliveInterval 0<br>#ClientAliveCountMax 0<br>#DenyUsers root<br>#DenyGroups root</p><h2 id="2-用root登录。关闭shell超时：命令行输入export-TMOUT-0"><a href="#2-用root登录。关闭shell超时：命令行输入export-TMOUT-0" class="headerlink" title="2 用root登录。关闭shell超时：命令行输入export TMOUT=0"></a>2 用root登录。关闭shell超时：命令行输入export TMOUT=0</h2><p><img src="./images/20200613131551161.png" alt="在这里插入图片描述"></p><h1 id="本地开启-和-关闭-技能"><a href="#本地开启-和-关闭-技能" class="headerlink" title="本地开启 和 关闭 技能"></a>本地开启 和 关闭 技能</h1><p>SSH进入 <code>/home/hilens/hda/skill</code> 目录下指定技能文件夹，<br>然后用 <code>hdactl start -s $skill_id</code> 命令拉起，便可以去日志里面查看调试信息。<br>若要停止技能，使用 <code>hdactl stop -s $skill_id</code>。其中技能的 skill_id 可以在技能的文件夹名字中看到（名字的最后一段）。</p><h1 id="安装yum-Linux软件安装工具"><a href="#安装yum-Linux软件安装工具" class="headerlink" title="安装yum Linux软件安装工具"></a>安装yum Linux软件安装工具</h1><p><a href="https://bbs.huaweicloud.com/forum/thread-36021-1-1.html">https://bbs.huaweicloud.com/forum/thread-36021-1-1.html</a></p><p>安装yum之后还需要配置yum源为华为开源镜像站地址，可以参考<a href="https://support.huaweicloud.com/csg_faq/csg_04_1209.html">https://support.huaweicloud.com/csg_faq/csg_04_1209.html</a></p><h1 id="安装gcc-python-dev等"><a href="#安装gcc-python-dev等" class="headerlink" title="安装gcc python-dev等"></a>安装gcc python-dev等</h1><p><a href="https://bbs.huaweicloud.com/forum/thread-53419-1-1.html">https://bbs.huaweicloud.com/forum/thread-53419-1-1.html</a>注意要添加源，否则安装不成功</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>base<span class="token punctuation">]</span><span class="token assign-left variable">name</span><span class="token operator">=</span>EulerOS-2.0SP8 base<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://developer.huawei.com/ict/site-euleros/euleros/repo/yum/2.8/os/aarch64/<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span><span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>http://developer.huawei.com/ict/site-euleros/euleros/repo/yum/2.8/os/RPM-GPG-KEY-EulerOS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="安装-make"><a href="#安装-make" class="headerlink" title="安装 make"></a>安装 make</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum -y <span class="token function">install</span> gcc automake autoconf libtool <span class="token function">make</span>yum <span class="token function">install</span> gcc gcc-c++ <span class="token comment"># 可以没有</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="安装curl"><a href="#安装curl" class="headerlink" title="安装curl"></a>安装curl</h1><p>easy_install</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://curl.haxx.se/download/curl-7.55.1.tar.gz<span class="token function">tar</span> -xzvf  curl-7.55.1.tar.gz<span class="token builtin class-name">cd</span> curl-7.55.1./configure<span class="token function">make</span><span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="配置源"><a href="#配置源" class="headerlink" title="配置源"></a>配置源</h1><p>CentOS、Euler、中标麒麟等redhat系的操作系统还可以使用epel的远程域名源，在/etc/yum.repos.d/路径下创建epel.repo文件，在epel.repo文件中写入如下内容，然后执行yum makecache即可使用：<br>[epel]<br>name=epel<br>baseurl=<a href="http://macports.pnl.gov/epel/7/aarch64/">http://macports.pnl.gov/epel/7/aarch64/</a><br>enabled=1<br>gpgcheck=0 </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/05/14/atlas-200-dk-deng-lu-mi-ma-zhi-qia-an-zhuang-ddk-he-lib-local/"/>
      <url>2021/05/14/atlas-200-dk-deng-lu-mi-ma-zhi-qia-an-zhuang-ddk-he-lib-local/</url>
      
        <content type="html"><![CDATA[<p>华为云账户：<br>账户：icv-hilens 密码：</p><p>昇腾资源：<a href="https://www.huaweicloud.com/ascend/resources">https://www.huaweicloud.com/ascend/resources</a></p><p><a href="https://drive.google.com/drive/folders/1Drs_Aiu7xx6S-ix95f9kNsA6ueKRpN2J">https://drive.google.com/drive/folders/1Drs_Aiu7xx6S-ix95f9kNsA6ueKRpN2J</a></p><p>切换root用户 su - root</p><h1 id="RJ45登录"><a href="#RJ45登录" class="headerlink" title="RJ45登录"></a>RJ45登录</h1><p>登录用户名：<code>ssh HwHiAiUser@192.168.0.2</code> (原用户：ssh <a href="mailto:&#x48;&#x77;&#72;&#105;&#65;&#x69;&#85;&#x73;&#x65;&#114;&#64;&#x31;&#57;&#50;&#46;&#49;&#54;&#x38;&#x2e;&#x30;&#46;&#x32;">&#x48;&#x77;&#72;&#105;&#65;&#x69;&#85;&#x73;&#x65;&#114;&#64;&#x31;&#57;&#50;&#46;&#49;&#54;&#x38;&#x2e;&#x30;&#46;&#x32;</a>)<br>登录密码：<code>asdfghjkl</code> (原密码：Mind@123)<br>root用户：切换root用户 <code>su - root</code>，密码<code>asdfghjkl</code> (原密码：Mind@123)</p><h2 id="修改登录用户名-可以改，但是改了Minstudio就连不上了"><a href="#修改登录用户名-可以改，但是改了Minstudio就连不上了" class="headerlink" title="修改登录用户名(可以改，但是改了Minstudio就连不上了)"></a>修改登录用户名(可以改，但是改了Minstudio就连不上了)</h2><ol><li>切换root用户 <code>su - root</code></li><li><code>vim /etc/passwd</code> 修改最后一行的第一个<code>HwHiAiUser</code>为<code>icv</code>，第二个不修改否则登入后找不到/home/icv目录<br><img src="./images/20200710102630268.png" alt="在这里插入图片描述"></li><li><code>vim /etc/shadow</code> 修改一个地方<br><img src="./images/20200710102707953.png" alt="在这里插入图片描述"></li><li><code>vim /etc/group</code> 修改一个地方<br><img src="./images/20200710102727994.png" alt="在这里插入图片描述"></li></ol><h1 id="内部指示灯的状态"><a href="#内部指示灯的状态" class="headerlink" title="内部指示灯的状态"></a>内部指示灯的状态</h1><p><img src="./images/20200709175022645.png" alt="在这里插入图片描述"></p><h1 id="IP配置"><a href="#IP配置" class="headerlink" title="IP配置"></a>IP配置</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /etc/network/interfaces.d/*auto loiface lo inet loopbackauto eth0iface eth0 inet staticaddress <span class="token number">192.168</span>.1.2netmask <span class="token number">255.255</span>.255.0gateway <span class="token number">192.168</span>.1.1auto usb0iface usb0 inet staticaddress <span class="token number">192.168</span>.1.2netmask <span class="token number">255.255</span>.255.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ssh-跳转失败"><a href="#ssh-跳转失败" class="headerlink" title="ssh 跳转失败"></a>ssh 跳转失败</h1><p>删除“known_hosts”文件。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> /home/username/.ssh/known_hosts <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="制卡过程"><a href="#制卡过程" class="headerlink" title="制卡过程"></a>制卡过程</h1><p><a href="https://support.huaweicloud.com/qs-atlas200dkappc32/atlased_04_0028.html">https://support.huaweicloud.com/qs-atlas200dkappc32/atlased_04_0028.html</a></p><h2 id="DDK资源下载（难找啊）"><a href="#DDK资源下载（难找啊）" class="headerlink" title="DDK资源下载（难找啊）"></a>DDK资源下载（难找啊）</h2><p><a href="https://www.huaweicloud.com/ascend/resources/ResourceDownload/DE51187AC4F0F5DBAB3A468952C95CADAC6308BFFFB5D064B9A30DBD2B73B4ABCEC6BAF7F594AE3C3FA89621AFFF3E3CFB4ED973618F8857D07706003D546332/DDK%20&%20Runtime/be3564c84a0546959b6439ebc4e8ae30/3/1/1?ticket=ST-63818-B0KaxNRDrP3SdJsy5XXR4xd2-sso&locale=zh-cn">https://www.huaweicloud.com/ascend/resources/ResourceDownload/DE51187AC4F0F5DBAB3A468952C95CADAC6308BFFFB5D064B9A30DBD2B73B4ABCEC6BAF7F594AE3C3FA89621AFFF3E3CFB4ED973618F8857D07706003D546332/DDK &amp; Runtime/be3564c84a0546959b6439ebc4e8ae30/3/1/1?ticket=ST-63818-B0KaxNRDrP3SdJsy5XXR4xd2-sso&amp;locale=zh-cn</a></p><h2 id="资源完整性校验"><a href="#资源完整性校验" class="headerlink" title="资源完整性校验"></a>资源完整性校验</h2><p><a href="https://support.huaweicloud.com/instg-atlas200dkappc32/atlasdd_03_0009.html">https://support.huaweicloud.com/instg-atlas200dkappc32/atlasdd_03_0009.html</a></p><h1 id="安装-MindStudio"><a href="#安装-MindStudio" class="headerlink" title="安装 MindStudio"></a>安装 MindStudio</h1><p>问答：<a href="https://www.huaweicloud.com/ascend/doc/mindstudio/2.1.0(beta)/zh/zh-cn_topic_0200347813.html">https://www.huaweicloud.com/ascend/doc/mindstudio/2.1.0(beta)/zh/zh-cn_topic_0200347813.html</a><br>所有工具下载：<a href="https://www.huaweicloud.com/ascend/resources/Tools">https://www.huaweicloud.com/ascend/resources/Tools</a></p><p>下载MindStudio<br><a href="https://www.huaweicloud.com/ascend/resources/Tools/0">https://www.huaweicloud.com/ascend/resources/Tools/0</a><br>下载DDK<br><a href="https://www.huaweicloud.com/ascend/resources/Tools/1">https://www.huaweicloud.com/ascend/resources/Tools/1</a></p><h1 id="安装-DDK-和-lib"><a href="#安装-DDK-和-lib" class="headerlink" title="安装 DDK 和 lib"></a>安装 DDK 和 lib</h1><p><a href="https://support.huaweicloud.com/instg-atlas200dkappc32/atlasdd_03_0013.html">https://support.huaweicloud.com/instg-atlas200dkappc32/atlasdd_03_0013.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/05/14/atlas-200-dkcam-she-xiang-tou-yolov3-opencv-can-shu-local/"/>
      <url>2021/05/14/atlas-200-dkcam-she-xiang-tou-yolov3-opencv-can-shu-local/</url>
      
        <content type="html"><![CDATA[<p>@[toc]</p><h1 id="cam例程"><a href="#cam例程" class="headerlink" title="cam例程"></a>cam例程</h1><p>项目github地址 <a href="https://github.com/Atlas200dk/sample-ascendcamera">https://github.com/Atlas200dk/sample-ascendcamera</a></p><ul><li><p>修改param_configure.conf内容为<code>remote_host=192.168.0.2</code>，</p></li><li><p>编译完，</p></li><li><p>运行，</p></li><li><p>在Atlas侧的out目录下运行<code>./workspace_mind_studio_sample-ascendcamera-1-3x-0-0 -v -c 0 --fps 20 -w 704 -h 576 -s 192.168.0.103:7002/qqq</code><br><img src="./images/20201001165042455.png" alt="在这里插入图片描述"></p></li><li><p>电脑Terminal <code>sudo bash run_present_server.sh</code>，用浏览器打开下面的地址和端口，<code>http://192.168.1.101:7003</code><br><img src="./images/20201001164553498.png" alt="在这里插入图片描述"><br>浏览器中就会出现如下，打勾，点击即可进入实时视频，<br><img src="./images/20201001164702461.png" alt="在这里插入图片描述"><br><img src="./images/20201001165125674.png" alt="在这里插入图片描述"></p></li></ul><h1 id="摄像头yolov3-opencv参数"><a href="#摄像头yolov3-opencv参数" class="headerlink" title="摄像头yolov3 opencv参数"></a>摄像头yolov3 opencv参数</h1><p><code>cv::cvtColor(yuvImg, bgrImg,   CV_YUV420sp2RGB);</code>opencv格式转化时填入的参数，<br><a href="https://docs.opencv.org/3.4/dc/d0f/imgproc_2include_2opencv2_2imgproc_2types__c_8h.html">https://docs.opencv.org/3.4/dc/d0f/imgproc_2include_2opencv2_2imgproc_2types__c_8h.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/05/14/atlas-200-dk-obj-local/"/>
      <url>2021/05/14/atlas-200-dk-obj-local/</url>
      
        <content type="html"><![CDATA[<p>@[toc]</p><h1 id="py-script"><a href="#py-script" class="headerlink" title="py script"></a>py script</h1><pre class="line-numbers language-c" data-language="c"><code class="language-c">获得脚本运行时传入的参数启动CPP_EXE，并将脚本收到的参数传入cpp可执行文件os<span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>CPP_EXE <span class="token operator">+</span> console_params<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="main"><a href="#main" class="headerlink" title="main"></a>main</h1><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">1.</span> 系统初始化 <span class="token function">HIAI_Init</span><span class="token punctuation">(</span>kDeviceId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">2.</span> 创建并启动图 hiai<span class="token operator">::</span><span class="token class-name">Graph</span><span class="token operator">::</span><span class="token function">CreateGraph</span><span class="token punctuation">(</span>kGraphConfigFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">3.</span> 获取图的实例 graph <span class="token operator">=</span> hiai<span class="token operator">::</span><span class="token class-name">Graph</span><span class="token operator">::</span><span class="token function">GetInstance</span><span class="token punctuation">(</span>kGraphId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">4.</span> 设置回调函数（根据规则自定义：重载RecvData），main中的回调函数是最后一个Engine传出的数据，这里不需要做什么，只是flag<span class="token operator">--</span> graph<span class="token operator">-></span><span class="token function">SetDataRecvFunctor</span><span class="token punctuation">(</span>      target_port_config<span class="token punctuation">,</span>      std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>CustomDataRecvInterface<span class="token operator">></span><span class="token punctuation">(</span>          <span class="token keyword">new</span> <span class="token punctuation">(</span>nothrow<span class="token punctuation">)</span> <span class="token function">CustomDataRecvInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          其中 CustomDataRecvInterface 类的定义有要求：<span class="token comment">// https://www.huaweicloud.com/ascend/doc/Atlas%20200%20DK/1.32.0.0(beta)/zh/zh-cn_topic_0204323953.html</span><span class="token comment">// https://www.huaweicloud.com/ascend/doc/Atlas%20200%20DK/1.32.0.0(beta)/zh/zh-cn_topic_0204323784.html</span><span class="token number">1.</span> 继承 hiai<span class="token operator">::</span>DataRecvInterface<span class="token number">2.</span> 重载RecvData方法<span class="token keyword">class</span> <span class="token class-name">CustomDataRecvInterface</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> hiai<span class="token operator">::</span><span class="token class-name">DataRecvInterface</span></span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>  <span class="token comment">/*** @brief: Constructor */</span>  <span class="token function">CustomDataRecvInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>  <span class="token operator">~</span><span class="token function">CustomDataRecvInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>  <span class="token comment">/*   * @brief: Receive data from call back engine   * @param [in]: received message   * @return: result   */</span>  HIAI_StatusT <span class="token function">RecvData</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token operator">&amp;</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 重写的内容如下，全局flag--，</span>HIAI_StatusT <span class="token class-name">CustomDataRecvInterface</span><span class="token operator">::</span><span class="token function">RecvData</span><span class="token punctuation">(</span>    <span class="token keyword">const</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// no need to read any message, only decrease flag</span>  mt<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  flag<span class="token operator">--</span><span class="token punctuation">;</span>  mt<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> HIAI_OK<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token number">5.</span> 发送数据，启动第一个Engine （general_image） graph<span class="token operator">-></span><span class="token function">SendData</span><span class="token punctuation">(</span>engine_id<span class="token punctuation">,</span> <span class="token string">"ConsoleParams"</span><span class="token punctuation">,</span>         static_pointer_cast<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span>param_ptr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 发送到第一个Engine的数据是 shared_ptr&lt;ConsoleParams> param_ptr 类型</span>   <span class="token comment">// https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0041.html</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>回调函数，重载而来，需要继承<code>hiai::DataRecvInterface</code>，<br><a href="https://www.huaweicloud.com/ascend/doc/Atlas%20200%20DK/1.32.0.0%28beta%29/zh/zh-cn_topic_0204323784.html">https://www.huaweicloud.com/ascend/doc/Atlas%20200%20DK/1.32.0.0(beta)/zh/zh-cn_topic_0204323784.html</a><br><img src="images/20200925130054696.png" alt="在这里插入图片描述"></p><h1 id="Engine1-general-image"><a href="#Engine1-general-image" class="headerlink" title="Engine1 - general_image"></a>Engine1 - general_image</h1><h2 id="Init-没做什么"><a href="#Init-没做什么" class="headerlink" title="Init 没做什么"></a>Init 没做什么</h2><p>该引擎运行前需要的初始化操作。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// GeneralImage 继承 hiai::Engine</span><span class="token keyword">class</span> <span class="token class-name">GeneralImage</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> hiai<span class="token operator">::</span><span class="token class-name">Engine</span></span> <span class="token punctuation">&#123;</span><span class="token comment">// Init什么也没做</span>HIAI_StatusT <span class="token class-name">GeneralImage</span><span class="token operator">::</span><span class="token function">Init</span><span class="token punctuation">(</span>    <span class="token keyword">const</span> hiai<span class="token operator">::</span>AIConfig<span class="token operator">&amp;</span> config<span class="token punctuation">,</span>    <span class="token keyword">const</span> vector<span class="token operator">&lt;</span>hiai<span class="token operator">::</span>AIModelDescription<span class="token operator">></span><span class="token operator">&amp;</span> model_desc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// do noting</span>  <span class="token keyword">return</span> HIAI_OK<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HIAI-IMPL-ENGINE-PROCESS"><a href="#HIAI-IMPL-ENGINE-PROCESS" class="headerlink" title="HIAI_IMPL_ENGINE_PROCESS"></a>HIAI_IMPL_ENGINE_PROCESS</h2><p><code>HIAI_IMPL_ENGINE_PROCESS</code>宏方法，上个引擎往本引擎发送数据，在这个宏里处理数据，发一次处理一次。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">1.</span> 检查arg0，提取input_path<span class="token number">2.</span> 提取文件路径到file_vec<span class="token number">3.</span> <span class="token keyword">for</span>，send每张图到 inference engine 用cv读取图像，把图像信息存入shared_ptr<span class="token operator">&lt;</span>EngineTrans<span class="token operator">></span> <span class="token operator">&amp;</span>image_handle发送<span class="token function">SendData</span><span class="token punctuation">(</span>kSendDataPort<span class="token punctuation">,</span> <span class="token string">"EngineTrans"</span><span class="token punctuation">,</span> static_pointer_cast<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span>image_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>发送成功则sleep <span class="token number">200</span>ms，image_handle<span class="token operator">-></span>is_finished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 否则再下一张<span class="token number">4.</span> 发送结束标志 image_handle<span class="token operator">-></span>is_finished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token function">SendData</span><span class="token punctuation">(</span>kSendDataPort<span class="token punctuation">,</span> <span class="token string">"EngineTrans"</span><span class="token punctuation">,</span>             static_pointer_cast<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span>image_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 发送到下一个Engine的数据是 shared_ptr&lt;EngineTrans> &amp;image_handle类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">继承 hiai<span class="token operator">::</span>Engine 的 GeneralImage 通过HIAI_IMPL_ENGINE_PROCESS参数 与 底层产生联系<span class="token punctuation">,</span><span class="token function">HIAI_IMPL_ENGINE_PROCESS</span><span class="token punctuation">(</span><span class="token string">"general_image"</span><span class="token punctuation">,</span>    GeneralImage<span class="token punctuation">,</span> INPUT_SIZE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="Engine2-general-inference"><a href="#Engine2-general-inference" class="headerlink" title="Engine2 - general_inference"></a>Engine2 - general_inference</h1><p>接受<code>Engine1 - general_image</code>发过来的图片，<br>dvpp预处理后交给模型管家前向传播得到输出结果，<br>发送处理结果到<code>Engine3 -  general_post</code>。</p><h2 id="Init"><a href="#Init" class="headerlink" title="Init"></a>Init</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">1.</span> 初始化 AI模型管家 aiModelManagerstd<span class="token operator">::</span>make_shared<span class="token operator">&lt;</span>hiai<span class="token operator">::</span>AIModelManager<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">2.</span> 设置模型描述，从graph<span class="token punctuation">.</span>config文件获取模型路径hiai<span class="token operator">::</span>AIModelDescription fd_model_desc<span class="token punctuation">;</span>fd_model_desc<span class="token punctuation">.</span><span class="token function">set_path</span><span class="token punctuation">(</span>model_path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">3.</span> 初始化模型管理器vector<span class="token operator">&lt;</span>hiai<span class="token operator">::</span>AIModelDescription<span class="token operator">></span> model_desc_vec<span class="token punctuation">;</span>  model_desc_vec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>fd_model_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>ai_model_manager_<span class="token operator">-></span><span class="token function">Init</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> model_desc_vec<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化模型管理器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HIAI-IMPL-ENGINE-PROCESS-1"><a href="#HIAI-IMPL-ENGINE-PROCESS-1" class="headerlink" title="HIAI_IMPL_ENGINE_PROCESS"></a>HIAI_IMPL_ENGINE_PROCESS</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">1.</span> 检查参数arg0，转化参数类型shared_ptr<span class="token operator">&lt;</span>EngineTrans<span class="token operator">></span> image_handle <span class="token operator">=</span> static_pointer_cast<span class="token operator">&lt;</span>EngineTrans<span class="token operator">></span><span class="token punctuation">(</span>arg0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">2.</span> 判断结束标志，发送数据到推理Engine<span class="token keyword">if</span> <span class="token punctuation">(</span>image_handle<span class="token operator">-></span>is_finished<span class="token punctuation">)</span> <span class="token function">SendToEngine</span><span class="token punctuation">(</span>image_handle<span class="token punctuation">)</span><span class="token function">SendData</span><span class="token punctuation">(</span>kSendDataPort<span class="token punctuation">,</span> <span class="token string">"EngineTrans"</span><span class="token punctuation">,</span>static_pointer_cast<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span>image_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0041.html</span><span class="token number">3.</span> 如果没有接收到结束标志，则预处理图片resize 返回 ImageData没有接收到结束标志，但一定接收到了图片（否则不会进入PROCESS），可以预处理图片咯 <span class="token operator">^</span>v<span class="token operator">^</span> 用dvpp resize图片，保证左顶even，右底odd<span class="token number">4.</span> 目的是丢到AI模型管家前向传播，inference 从dvpp的 ImageData 格式 到 neural格式 到 hiai<span class="token operator">::</span>IAITensor格式ImageData <span class="token operator">--</span> <span class="token operator">></span> hiai<span class="token operator">::</span>AINeuralNetworkBuffer <span class="token operator">--</span><span class="token operator">></span> hiai<span class="token operator">::</span>IAITensor把 hiai<span class="token operator">::</span>IAITensor 图片push到vector<span class="token operator">&lt;</span>shared_ptr<span class="token operator">&lt;</span>hiai<span class="token operator">::</span>IAITensor<span class="token operator">>></span>创建输出Tensor vector<span class="token operator">&lt;</span>shared_ptr<span class="token operator">&lt;</span>hiai<span class="token operator">::</span>IAITensor<span class="token operator">>></span> output_data<span class="token punctuation">;</span>   <span class="token comment">// 实参</span>ai_model_manager_<span class="token operator">-></span><span class="token function">CreateOutputTensor</span><span class="token punctuation">(</span>input_data_vec<span class="token punctuation">,</span> output_data_vec<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 形参</span>开始推理Processai_model_manager_<span class="token operator">-></span><span class="token function">Process</span><span class="token punctuation">(</span>ai_context<span class="token punctuation">,</span> input_data_vec<span class="token punctuation">,</span> output_data_vec<span class="token punctuation">,</span> kAiModelProcessTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">5.</span> 发送结果<span class="token function">SendResult</span><span class="token punctuation">(</span>image_handle<span class="token punctuation">,</span> output_data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">,</span> 对于每个输出Tensor，output_data_vecimage_handle<span class="token operator">-></span>inference_res<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">SendData</span><span class="token punctuation">(</span>kSendDataPort<span class="token punctuation">,</span> <span class="token string">"EngineTrans"</span><span class="token punctuation">,</span>                        static_pointer_cast<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span>image_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Engine3-general-post"><a href="#Engine3-general-post" class="headerlink" title="Engine3 -  general_post"></a>Engine3 -  general_post</h1><p>接收模型输出的结果，后处理</p><h2 id="Init-1"><a href="#Init-1" class="headerlink" title="Init"></a>Init</h2><pre class="line-numbers language-none"><code class="language-none">什么也没做<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="HIAI-IMPL-ENGINE-PROCESS-2"><a href="#HIAI-IMPL-ENGINE-PROCESS-2" class="headerlink" title="HIAI_IMPL_ENGINE_PROCESS"></a>HIAI_IMPL_ENGINE_PROCESS</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">1.</span> 检查参数arg0，转化参数类型shared_ptr<span class="token operator">&lt;</span>EngineTrans<span class="token operator">></span> result <span class="token operator">=</span> static_pointer_cast<span class="token operator">&lt;</span>EngineTrans<span class="token operator">></span><span class="token punctuation">(</span>arg0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">2.</span> 判断结束标志 若结束发送空字符串<span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token operator">-></span>is_finished<span class="token punctuation">)</span>   <span class="token function">SendSentinel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 哨兵</span>  shared_ptr<span class="token operator">&lt;</span>string<span class="token operator">></span> <span class="token function">sentinel_msg</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">(</span>nothrow<span class="token punctuation">)</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">SendData</span><span class="token punctuation">(</span>kSendDataPort<span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">,</span>                 static_pointer_cast<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span>sentinel_msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">3.</span> 如果不是结束标志 则后处理模型输出 PostProcess解码模型输出的Tensor  decodeTensor（yolo3的精髓）非极大值抑制算法 nonMaximumSuppression（yolo3的精髓）返回 std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>BoundingBox<span class="token operator">></span> result<span class="token punctuation">;</span>画框框保存图片<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="一些宏接口"><a href="#一些宏接口" class="headerlink" title="一些宏接口"></a>一些宏接口</h1><h2 id="1-HIAI-REGISTER-DATA-TYPE-自定义数据结构-的宏接口"><a href="#1-HIAI-REGISTER-DATA-TYPE-自定义数据结构-的宏接口" class="headerlink" title="1. HIAI_REGISTER_DATA_TYPE 自定义数据结构 的宏接口"></a>1. HIAI_REGISTER_DATA_TYPE 自定义数据结构 的宏接口</h2><p>宏原型 <code>HIAI_REGISTER_DATA_TYPE(name, type)</code><br>为用户自定义的数据结构类型提供序列化和反序列化机制。<br><a href="https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0063.html">https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0063.html</a></p><h2 id="2-HIAI-DEFINE-PROCESS-定义引擎输入出端口数"><a href="#2-HIAI-DEFINE-PROCESS-定义引擎输入出端口数" class="headerlink" title="2. HIAI_DEFINE_PROCESS 定义引擎输入出端口数"></a>2. HIAI_DEFINE_PROCESS 定义引擎输入出端口数</h2><p><a href="https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0048.html">https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0048.html</a><br>宏原型<code>HIAI_DEFINE_PROCESS（inputPortNum, outputPortNum）</code></p><p>用户直接调用该<code>宏</code> 定义Engine的输入与输出端口数 <code>[1 , 16]</code>。</p><p>用户调用宏的顺序应该是：<code>HIAI_DEFINE_PROCESS</code> –&gt; <code>HIAI_IMPL_ENGINE_PROCESS</code></p><h2 id="3-HIAI-IMPL-ENGINE-PROCESS-接受处理数据"><a href="#3-HIAI-IMPL-ENGINE-PROCESS-接受处理数据" class="headerlink" title="3. HIAI_IMPL_ENGINE_PROCESS 接受处理数据"></a>3. HIAI_IMPL_ENGINE_PROCESS 接受处理数据</h2><p><a href="https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0049.html">https://support.huaweicloud.com/api-matrix-atlas200dkappc32/atlasmatrix_07_0049.html</a><br>宏原型<code>HIAI_IMPL_ENGINE_PROCESS(name, engineClass, inPortNum)</code></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">engineClass 需要继承 hiai<span class="token operator">::</span>Engine需要重写Init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="4-HIAI-ENGINE-LOG"><a href="#4-HIAI-ENGINE-LOG" class="headerlink" title="4. HIAI_ENGINE_LOG"></a>4. HIAI_ENGINE_LOG</h2><p><a href="https://support.huaweicloud.com/api-matrix-atlas200dkappc30/atlasmatrix_07_0149.html">https://support.huaweicloud.com/api-matrix-atlas200dkappc30/atlasmatrix_07_0149.html</a><br>宏原型很多，打印日志的格式有8种。</p><p>调用<code>HIAI_ENGINE_LOG</code>后，系统将日志记录日志文件中，日志文件在<code>Host侧</code>或开发者板的<code>/var</code>目录下。<br><code>Device侧</code>的日志被记录在文件名称以<code>device-id</code>开头的日志文件中，<br><code>Host侧</code>的日志被记录在文件名称以<code>host-0</code>开头的日志文件中。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">最简单的一种<span class="token function">HIAI_ENGINE_LOG</span><span class="token punctuation">(</span><span class="token string">"Start initialize!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>某一篇博客</title>
      <link href="2021/05/12/hello-world/"/>
      <url>2021/05/12/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tag1 </tag>
            
            <tag> tag2 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
